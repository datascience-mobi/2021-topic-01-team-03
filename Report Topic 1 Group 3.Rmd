---
title: "Topic 1 Group 3: Drug viability screens for oncological and non-oncological treatments"
author: "Cedrik Neber, Lea Ahrens, Lennard Kleemann, Ilya Schneider, Xenia Quaas"
date: "19 7 2021"
output:
  html_document: default
---

Drug repurposing is a strategy in which already authorized drugs are used to treat diseases for which they were not intended. This has advantages, especially in terms of cost, time and the risk to fail in research and development of a new drug. In this context, computational approaches are gaining in importance, as they allow large amounts of data to be analyzed (Pushpakom *et al.*, 2019).

According to the Global Cancer Statistics 2020, brain cancer is a rarer cancer type, accounting for 2,5% of all new cancers. Nevertheless, its mortality rate is comparatively high, which makes drug repurposing an interesting application.


#Structure of our project

This project uses seven datasets generated by the Broad Institute using the PRISM strategy. It investigates the general question of whether it is possible to predict the effectiveness of a drug in the treatment of brain cancer. 

To explore our main question, we examined four milestones:

**1) How can we distinguish the most effective drugs?**
**2) What are the targets of the effective drugs?**
**3) Are there any genetic markers that are specific for brain cancer subtypes?**
**4) What other factors contribute to drug and effectiveness prediction?**

#Data Clean up

As the datasets also contain information on other cancer types, we removed non-relevant cell lines. In addition, we classified the datasets according to brain cancer subtypes, as this information was used for later analyses. We treated NA values either by removing the cell line or by replacing it with a mean value, depending on the dataset. Since we want to take a look at the different brain cancer subtypes as part of our third milestone, we also created subtye data frames during the cleaning process. 

```{r}
#play around lines 43 to 76 
#also add the subtype classification in lines 80 to 91, code optimisation needed 
#++Descriptive statistics++

```


#Identification of effective drugs

The `prism` data frame gives information on treatments which were used in the screening effort. These treatments include 4,518 drugs with doses ranging from 0.00061034 $\mu M to 10 $\mu M. There are 8 standard doses into which we have divided the data frame by creating a list to store them. 

```{r}
# play around lines 106 to 141 
```

Nevertheless, treatments were given whose doses did not correspond to the standard one's. We have assigned these to the standard doses to which there is the least deviation, assuming that the focus of the project is on the drug itself and not on the dose used. 


To identify the most effective drugs, we looked at the effectiveness values of the `prism` data frame. The more negative the value, the more effective the treatment. Contrary to the threshold value 0.3 of Corsello *et al.* we have set the threshold value 0.2. We found this to be useful as it corresponds to the median of the ```brain_cancer``` data frame (filtered brain cancer cell lines from the ```prism``` data frame), allowing us to select half of the drugs by this step. 

In order to reduce the number of drugs and to be able to make later predictions for our main question independent of the dose, we selected drugs that are effective in all doses. To do this, we first identified the drugs whose mean effectiveness across all cell lines in the dose subset data frames was less than or equal to the established threshold. Second, we compared these drugs and selected the ones that are present in all subsets. Thereby we have obtained **51 drugs**.


```{r}
#hier würde ich einfach eine Liste mit den 51 Drogen reinpacken 
```


We decided to chose a dose to work on with, since the model we want to establish should output drugs for treatment regardless of their concentration. We selected dose 7, 10 $\mu M, s this has the highest variance and is therefore suitable for most treatments. 

```{r}
#und direkt die d7 dosage mit der variance begründen 
```

# Identification of genetic markers

For this milestone, we wanted to look at brain cancer subtypes. Thereby the column ```disease_subtype``` of the ```prism.cl``` dataset gives information about the subtype whereby a distinction is made between astrocytoma, medulloblastoma, glioblastoma and glioma. 

+++ Boxplots von Cedrik+++

In these boxplots, one can see the distribution of the effectiveness scores of the 51 effective drugs in the subtypes. These can be used to compare the distributions of the effectiveness values for the subtypes. The median in astrocytoma, glioblastoma and glioma is in the middle of the box, which indicates a symmetrical distribution. 
The box of medulloblastoma differs from those of the other subtypes. It is larger and thus there is a greater spread of data points. In addition, the median is right-shifted and at a lower effective score. 

Although the boxplots provide information that the treatments worked differently effectively for the subtypes, they do not indicate whether there are drugs that worked well specifically for one subtype.  


+++


To find out which genes are expressed significantly different in brain cancer cell lines compared to other cancers, a statistical test can be applied. For this purpose, it must first be examined whether the available data is normally distributed.
A statistical test, the Shapiro Wilks test, can also be used for this purpose. Here, the H0 hypothesis assumes that the distribution is a normal distribution. If the p-value is small, the H0 hypothesis is rejected and it is assumed that the data are not normally distributed. 
The test was applied to the 19177 genes so the columns of the prism.exp dataset to determine the across the 34 cell lines. 
Of these, 9799 p-values were less than or equal to the 0.05 significance level and thus only half of the genes were normally distributed. We then decided to apply a non-parametric test.  

## Wilcoxon Rank Sum test

We decided to apply an unpaired Wilcoxon Rank Sum test. For this we created the dataset ```non_bc_exp```, which takes all cell lines from the ```prism.exp``` dataset that do not belong to the brain cancer disease type. There are 447 cell lines in it, for example from lung cancer, skin cancer, pancreatic cancer or ovarian cancer. Although these data sets are not the same size, this is not a problem in this case, as the test is based on ranking the individual values.

Before applying the test, however, we had to take into account that we perform a Z-transformation by which the values are centered and scaled to match the different ranges of the variation. In addition, we had to take into account that for some genes the expression value was zero. Therefore, we added a so-called pseudocount, which is the lowest expression value per data set. 

When performing the loop to the Wilcoxon test, the H0 hypothesis is tested simultaneously for all genes. This leads to a multiplicity problem in which the probability of increasing the number of false positive test results is increased. To adjust the number of significant p-values for this problem, we consider two types of corrections. The Bonferroni and the Benjamini-Hochberg corrections. 

```{r}
# Chunk from Wilcoxon test?
```

Thereby, the number of genes that are significantly differentially expressed differ strongly: The Bonferroni correction results in 1859 genes and the Benjamini-Hochberg correction results in 8948 genes. We have chosen to continue with the Bonferroni correction genes, although this correction is more conservative. 

To visualize differentially expressed genes one can use a volcano plot. The statistical significance of the gene is plotted in relation to the magnitude of the difference between the two datasets at a negative base 2 log fold change. We decided to extract genes whose log2 fold change is less than or equal to -1 and greater than or equal to 1, respectively. These genes are shown in blue in the plot. Additionally, we have extracted the top 20 genes with the smallest p-value, which are highlighted in red.

## Linear regression model with universal drug

In preparation for our final milestone, we want to further reduce the number of genes. To do this, we used a linear regression model to model the effectiveness score of a drug based on the 20 genes filtered. The drug used should have a consistent effect for all brain cancer cell lines. Therefore, we filtered out a universal drug by dividing the range of efficacy values into intervals and then determining the interval with the highest number of cell lines responding to treatment for all drugs. 

From this, it returned the drug with the Broad ID "BRD-K79145628-001-05-5". To verify our previous steps, we also applied the code used to the non-brain cancer cell lines. Our assumption was confirmed that this drug is the universal one only for the brain cancer cell lines. 

++++
Korrelierte Gene

Regressionsmodell







2) What are the targets of the effective drugs?

To analyse the targets of the previously described effective drugs, we 

```{r}
# ab chunk 10 im comparison.Rmd 
```


3) Are there any genetic markers that are specific for brain cancer subtypes?
- Examine gene targets of the effective drugs
- Find a relationship between gene targets and brain cancer subtypes
- Wilcoxon Signed Rank Test


4) What other factors contribute to predicting the effectiveness of a drug? 
- Estimate the relevant variables
- Look for correlations between variables and leave only variables with high variance
- Reduce the amount of dimensions by conducting a PCA
- Regression model with PCA
- Compare the real effectiveness with the estimated one 




Rough version with possible visualizations (6 plots in total)


Q3:
- Visualization of most relevant genes in cell lines via a *heatmap* with shows the degree of expression